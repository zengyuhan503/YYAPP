"use strict";const e=require("../../common/vendor.js"),a=require("../../utils/api/index.js");if(!Array){(e.resolveComponent("uni-easyinput")+e.resolveComponent("uni-forms-item")+e.resolveComponent("uni-forms"))()}Math||((()=>"../../uni_modules/uni-easyinput/components/uni-easyinput/uni-easyinput.js")+(()=>"../../uni_modules/uni-forms/components/uni-forms-item/uni-forms-item.js")+(()=>"../../uni_modules/uni-forms/components/uni-forms/uni-forms.js"))();const n={__name:"index",setup(n){let t=e.ref({avatar:null,nickname:null,phone:""});const o=()=>{let n={...t.value};n.avatar=n.avatar.replace("https://www.yuyandental.com/",""),a.EditUserInfo(n).then((a=>{console.log(a),e.index.showToast({title:"修改成功",duration:2e3}),r()}))},r=()=>{a.GetServerUserInfo().then((e=>{console.log(e.avatar.indexOf("thirdwx.qlogo")),-1==e.avatar.indexOf("thirdwx.qlogo")?t.value.avatar="https://www.yuyandental.com/"+e.avatar:t.value.avatar=e.avatar,t.value.nickname=e.nickname}))},i=n=>{let o=n.detail.avatarUrl;e.index.uploadFile({url:"https://www.yuyandental.com/api/upload",filePath:o,name:"limit_image",success:n=>{let o=n.data;o=JSON.parse(o),t.value.avatar="https://www.yuyandental.com/"+o.data;let i={...t.value,avatar:o.data};a.EditUserInfo(i).then((a=>{e.index.showToast({title:"修改成功",duration:2e3,icon:"success"}),r()}))}})},l=n=>{let o=n.detail;if(-1!=o.errMsg.indexOf("ok")){let n={code:o.code};a.GetUserPhone(n).then((n=>{if(n===t.value.phone)return!1;t.value.phone=n;let o={...t.value};o.avatar=o.avatar.replace("https://www.yuyandental.com/",""),a.EditUserInfo(o).then((a=>{e.index.showToast({title:"修改成功",duration:2e3,icon:"success"}),r()}))}))}};return e.onMounted((()=>{try{r(),t.value.phone=e.index.getStorageSync("yy-phone")}catch(a){e.index.removeStorageSync("yy-userinfo"),e.wx$1.redirectTo({url:"/pages/user/index"})}})),(a,n)=>({a:e.unref(t).avatar,b:e.o(i),c:e.o(o),d:e.o((a=>e.unref(t).nickname=a)),e:e.p({inputBorder:!1,color:"rgba(0, 0, 0, 0.3)",placeholder:"请输入姓名",modelValue:e.unref(t).nickname}),f:e.p({label:"姓名"}),g:e.o((a=>e.unref(t).phone=a)),h:e.p({disabled:!0,type:"number",inputBorder:!1,color:"rgba(0, 0, 0, 0.3)",placeholder:"请输入手机号",modelValue:e.unref(t).phone}),i:e.o(l),j:e.p({label:"电话"}),k:e.sr("baseForm","583a29b0-0"),l:e.p({modelValue:e.unref(t),"label-position":"left"})})}},t=e._export_sfc(n,[["__scopeId","data-v-583a29b0"]]);wx.createPage(t);
