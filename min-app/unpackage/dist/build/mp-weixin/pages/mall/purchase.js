"use strict";const e=require("../../common/vendor.js"),n=require("../../utils/api/index.js");if(!Array){(e.resolveComponent("uni-icons")+e.resolveComponent("uni-popup"))()}Math||((()=>"../../uni_modules/uni-icons/components/uni-icons/uni-icons.js")+(()=>"../../uni_modules/uni-popup/components/uni-popup/uni-popup.js"))();const a={__name:"purchase",setup(a){const u=e.ref(1);let r=e.ref(null),o=e.ref(!1),t=e.ref(null),l=e.ref({}),i=e.ref({name:"",phone:"",provinces:"",address:"",is_default:""});e.onLoad((e=>{r.value=e.id,v(),_()}));const s=()=>{i.value.is_default=!i.value.is_default},d=e=>{let n=e.detail.value;if(i.value.provinces==n.join("-"))return!1;i.value.provinces=n.join("-"),c()};e.watch(u,(e=>{v()}));let p=!1;const c=()=>{if(!f)return!1;i.value.id=0,console.log(i.value)};let f=!1;const v=()=>{let e={goods_id:r.value,number:u.value};n.GetCalculate(e).then((e=>{l.value=e,""!=e.address?(i.value=e.address,i.value.is_default="1",p=!0):p=!1,f=!0}))};let m=e.ref([]);const _=()=>{n.GetAddressList().then((e=>{if(m.value=e,0==e.length)return!1;t.value=e.find((e=>"1"==e.is_default)).id}))};let g="";const h=()=>{let a={goods_id:r.value,number:u.value,address_id:p?i.value.id:0,remark:i.value.remark||"",name:i.value.name,phone:i.value.phone,provinces:i.value.provinces,address:i.value.address,is_default:""==i.value.is_default?0:i.value.is_default};n.CreateOrder(a).then((a=>{g=a.order_id,n.CreateWxPay(a).then((n=>{e.wx$1.requestPayment({timeStamp:n.timeStamp,nonceStr:n.nonceStr,package:n.package,signType:n.signType,paySign:n.paySign,success(){o.value=!0},fail(n){e.wx$1.showToast({icon:"none",title:"支付失败,即将前往订单详情",duration:2e3}),setTimeout((()=>{e.index.redirectTo({url:"/pages/detail/unpaid?id="+g})}),2e3),console.log(n)}})}))}))},y=()=>{e.index.redirectTo({url:"/pages/detail/unpaid?id="+g})},x=()=>{e.index.redirectTo({url:"/pages/user/index"})};let w=e.ref(null);const j=()=>{console.log(),w.value.open()},k=()=>{w.value.close()};return(n,a)=>e.e({a:"https://www.yuyandental.com/"+e.unref(l).head_image,b:e.t(e.unref(l).title),c:e.t(e.unref(l).sale_price),d:1==u.value},1==u.value?{}:{e:e.o((e=>u.value--))},{f:e.t(u.value),g:e.o((e=>u.value++)),h:e.unref(i).is_default,i:e.o(s),j:e.o([n=>e.unref(i).name=n.detail.value,c]),k:e.unref(i).name,l:e.o([n=>e.unref(i).phone=n.detail.value,c]),m:e.unref(i).phone,n:e.o([n=>e.unref(i).provinces=n.detail.value,c]),o:e.unref(i).provinces,p:e.o(d),q:e.o([n=>e.unref(i).address=n.detail.value,c]),r:e.unref(i).address,s:e.p({type:"right",size:"18"}),t:e.o(j),v:e.o(k),w:e.p({type:"left",size:"30",color:"#000000"}),x:e.f(e.unref(m),((n,a,u)=>e.e({a:e.t(n.name),b:e.t(n.phone),c:1==n.is_default},(n.is_default,{}),{d:e.t(n.provinces),e:e.t(n.address),f:e.unref(t)==n.id?1:"",g:a,h:e.o((e=>(e=>{t.value=e.id,i.value=e})(n)),a)}))),y:e.sr(w,"80ed3809-1",{k:"popup"}),z:e.p({"background-color":"#fff",type:"bottom"}),A:e.unref(l).sale_price!=e.unref(l).price},(e.unref(l).sale_price,e.unref(l).price,{}),{B:e.t(e.unref(l).total_price),C:e.o(h),D:e.unref(o)},e.unref(o)?{E:e.o(x),F:e.o(y)}:{})}},u=e._export_sfc(a,[["__scopeId","data-v-80ed3809"]]);wx.createPage(u);
